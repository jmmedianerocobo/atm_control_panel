<ion-header>
  <ion-toolbar>
    <ion-title>ATM Control Panel</ion-title>

    <ion-buttons slot="start">
      <ion-back-button defaultHref="/distance-view"></ion-back-button>
    </ion-buttons>

    <ion-buttons slot="end">

      <!-- Configuración -->
      <ion-button (click)="openConfigPage()" fill="clear">
        <ion-icon src="/assets/icon/settings-outline.svg"></ion-icon>
      </ion-button>

      <!-- Ajustes BT -->
      <ion-button
        (click)="goToBluetoothSettings()"
        color="secondary"
        fill="outline"
        size="small"
      >
        Ajustes BT
      </ion-button>

      <ion-chip [color]="(isConnected$ | async) ? 'success' : 'danger'">
        <ion-label>
          {{ (isConnected$ | async) ? 'Conectado' : 'Desconectado' }}
        </ion-label>
      </ion-chip>

    </ion-buttons>
  </ion-toolbar>
</ion-header>


<ion-content class="ion-padding">

  <div class="two-column-container">

    <!-- ========================================================= -->
    <!-- ========================== LEFT ========================= -->
    <!-- ========================================================= -->

    <div class="column panel-container">

      <div class="panel-header">Lado Izquierdo</div>

      <div class="panel-body">

        <!-- Icono aspersor con fondo dinámico -->
        <div class="spray-icon left-icon"
          [ngClass]="{
            'bg-success': (distanceLeft$ | async)! < (thresholdCm$ | async)!,
            'bg-danger':  (distanceLeft$ | async)! >= (thresholdCm$ | async)!
          }">
          <img src="assets/icon/spray_izda_transp.svg" alt="Left Spray" />
        </div>

        <!-- Estado -->
        <div class="info-block">
          <label>Distancia</label>

          <div class="status-line">

            <ion-icon
              name="ellipse"
              [color]="
                (distanceLeft$ | async)! < (thresholdCm$ | async)!
                  ? 'success'
                  : 'medium'
              "
            ></ion-icon>

            <span *ngIf="(distanceLeft$ | async) !== null">
              {{ (distanceLeft$ | async)! < (thresholdCm$ | async)! ? 'ACTIVO' : 'INACTIVO' }}
              -
              {{ (distanceLeft$ | async) | number:'1.0-0' }} cm
            </span>

            <span *ngIf="(distanceLeft$ | async) === null">
              SIN DATOS
            </span>
          </div>
        </div>

        <!-- Tiempo apertura -->
        <div class="info-block">
          <label>Tiempo en Apertura</label>
          <div class="value">{{ timeOpenLeft | number:'1.2-2' }} s</div>
        </div>

        <!-- Número aperturas -->
        <div class="info-block">
          <label>Número de Aperturas</label>
          <div class="value">{{ openCountLeft }}</div>
        </div>

        <!-- Litros aplicados -->
        <div class="info-block">
          <label>Litros Aplicados lado Izquierdo</label>
          <div class="value">{{ litersLeft | number:'1.2-2' }}</div>
        </div>

      </div>
    </div>

    <!-- ========================================================= -->
    <!-- ========================== RIGHT ======================== -->
    <!-- ========================================================= -->

    <div class="column panel-container">

      <div class="panel-header">Lado Derecho</div>

      <div class="panel-body">

        <!-- Icono aspersor con fondo dinámico -->
        <div class="spray-icon right-icon"
          [ngClass]="{
            'bg-success': (distanceRight$ | async)! < (thresholdCm$ | async)!,
            'bg-danger':  (distanceRight$ | async)! >= (thresholdCm$ | async)!
          }">
          <img src="assets/icon/spray_dcha_transp.svg" alt="Right Spray" />
        </div>

        <!-- Estado -->
        <div class="info-block">
          <label>Distancia</label>

          <div class="status-line">

            <ion-icon
              name="ellipse"
              [color]="
                (distanceRight$ | async)! < (thresholdCm$ | async)!
                  ? 'success'
                  : 'medium'
              "
            ></ion-icon>

            <span *ngIf="(distanceRight$ | async) !== null">
              {{ (distanceRight$ | async)! < (thresholdCm$ | async)! ? 'ACTIVO' : 'INACTIVO' }}
              -
              {{ (distanceRight$ | async) | number:'1.0-0' }} cm
            </span>

            <span *ngIf="(distanceRight$ | async) === null">
              SIN DATOS
            </span>
          </div>
        </div>

        <!-- Tiempo apertura -->
        <div class="info-block">
          <label>Tiempo en Apertura</label>
          <div class="value">{{ timeOpenRight | number:'1.2-2' }} s</div>
        </div>

        <!-- Número aperturas -->
        <div class="info-block">
          <label>Número de Aperturas</label>
          <div class="value">{{ openCountRight }}</div>
        </div>

        <!-- Litros aplicados -->
        <div class="info-block">
          <label>Litros Aplicados lado Derecho</label>
          <div class="value">{{ litersRight | number:'1.2-2' }}</div>
        </div>

      </div>
    </div>

  </div>

  <div class="total-panel">
    <span>Total Litros Aplicados</span>
    <strong>{{ (litersLeft + litersRight) | number:'1.2-2' }}</strong>
  </div>

</ion-content>
