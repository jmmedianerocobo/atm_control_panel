<ion-header>
  <ion-toolbar>
    <ion-title>ATM Control Panel</ion-title>

    <ion-buttons slot="start">
      <ion-back-button defaultHref="/distance-view"></ion-back-button>
    </ion-buttons>

    <ion-buttons slot="end">
      <ion-button (click)="openConfigPage()" fill="clear">
        <ion-icon src="/assets/icon/settings-outline.svg"></ion-icon>
      </ion-button>

      <ion-button
        (click)="goToBluetoothSettings()"
        color="secondary"
        fill="outline"
        size="small"
      >
        Ajustes BT
      </ion-button>

      <ion-chip [color]="(isConnected$ | async) ? 'success' : 'danger'">
        <ion-label>
          {{ (isConnected$ | async) ? 'Conectado' : 'Desconectado' }}
        </ion-label>
      </ion-chip>
    </ion-buttons>

  </ion-toolbar>
</ion-header>


<ion-content class="ion-padding">

  <div class="two-column-container">

    <!-- ========================================================= -->
    <!-- ========================== LEFT ========================= -->
    <!-- ========================================================= -->
    <div class="column panel-container">

      <div class="panel-header">Lado Izquierdo</div>

      <div class="panel-body">

        <!-- Estado -->
 <div class="info-block"
             [ngClass]="{
               'active-spray': (distanceLeft$ | async)! < (thresholdCm$ | async)!,
               'inactive-spray': (distanceLeft$ | async)! >= (thresholdCm$ | async)!
             }">

          <label>Distancia</label>

          <div class="distance-row">

            <!-- Valor izquierda -->
            <div class="distance-value">
              <ng-container *ngIf="distanceLeft$ | async as distLeft; else noRight">
                {{ distLeft }} cm
              </ng-container>
              <ng-template #noLeft>--</ng-template>
            </div>

            <!-- Icono derecha -->
            <div class="spray-icon-mini"
                 [ngClass]="{
                    'active': (distanceLeft$ | async)! < (thresholdCm$ | async)!,
                    'hidden': (distanceLeft$ | async)! >= (thresholdCm$ | async)!
                 }">
              <img src="assets/icon/spray_izda_transp.svg" />
            </div>

          </div>
        </div>

        <!-- Tiempo apertura -->
        <div class="info-block">
          <label>Tiempo en Apertura</label>
          <div class="value">{{ timeOpenLeft | number:'1.2-2' }} s</div>
        </div>

        <!-- Número aperturas -->
        <div class="info-block">
          <label>Número de Aperturas</label>
          <div class="value">{{ openCountLeft }}</div>
        </div>

        <!-- Litros -->
        <div class="info-block">
          <label>Litros Aplicados lado Izquierdo</label>
          <div class="value">{{ litersLeft | number:'1.2-2' }}</div>
        </div>

      </div>
    </div>

    <!-- ========================================================= -->
    <!-- ========================== RIGHT ======================== -->
    <!-- ========================================================= -->
    <div class="column panel-container">

      <div class="panel-header">Lado Derecho</div>

      <div class="panel-body">

        <!-- Estado -->
        <div class="info-block"
             [ngClass]="{
               'active-spray': (distanceRight$ | async)! < (thresholdCm$ | async)!,
               'inactive-spray': (distanceRight$ | async)! >= (thresholdCm$ | async)!
             }">

          <label>Distancia</label>

          <div class="distance-row">

            <!-- Valor izquierda -->
            <div class="distance-value">
              <ng-container *ngIf="distanceRight$ | async as distRight; else noRight">
                {{ distRight }} cm
              </ng-container>
              <ng-template #noRight>--</ng-template>
            </div>

            <!-- Icono derecha -->
            <div class="spray-icon-mini"
                 [ngClass]="{
                    'active': (distanceRight$ | async)! < (thresholdCm$ | async)!,
                    'hidden': (distanceRight$ | async)! >= (thresholdCm$ | async)!
                 }">
              <img src="assets/icon/spray_dcha_transp.svg" />
            </div>

          </div>
        </div>

        <div class="info-block">
          <label>Tiempo en Apertura</label>
          <div class="value">{{ timeOpenRight | number:'1.2-2' }} s</div>
        </div>

        <div class="info-block">
          <label>Número de Aperturas</label>
          <div class="value">{{ openCountRight }}</div>
        </div>

        <div class="info-block">
          <label>Litros Aplicados lado Derecho</label>
          <div class="value">{{ litersRight | number:'1.2-2' }}</div>
        </div>

      </div>
    </div>
  </div>

  <div class="total-panel">
    <span>Total Litros Aplicados</span>
    <strong>{{ (litersLeft + litersRight) | number:'1.2-2' }}</strong>
  </div>

</ion-content>
