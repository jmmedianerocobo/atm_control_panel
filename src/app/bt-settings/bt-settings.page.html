<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/distance-view"></ion-back-button>
    </ion-buttons>
    <ion-title>Bluetooth</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <!-- ESTADO -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Conexión</ion-card-title>
    </ion-card-header>

    <ion-card-content>

      <ion-item>
        <ion-label>Estado</ion-label>

        <ion-chip color="success" *ngIf="isConnected$ | async">Conectado</ion-chip>
        <ion-chip color="danger" *ngIf="!(isConnected$ | async)">Desconectado</ion-chip>
      </ion-item>

      <ion-button expand="block" color="danger"
                  *ngIf="isConnected$ | async"
                  (click)="disconnect()">
        Desconectar
      </ion-button>

    </ion-card-content>
  </ion-card>


  <!-- EMPAREJADOS -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Dispositivos emparejados</ion-card-title>
    </ion-card-header>

    <ion-list>
      <ion-item *ngFor="let dev of pairedDevices$ | async">
        <ion-label>
          <h2>{{ dev.name }}</h2>
          <p>{{ dev.address }}</p>
        </ion-label>

        <ion-button color="primary"
                    (click)="connectTo(dev)"
                    [disabled]="isConnected$ | async">
          Conectar
        </ion-button>
      </ion-item>

      <ion-item *ngIf="(pairedDevices$ | async)?.length === 0">
        <ion-label>No hay dispositivos emparejados.</ion-label>
      </ion-item>
    </ion-list>
  </ion-card>


  <!-- ESCANEO -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Buscar nuevos dispositivos</ion-card-title>
    </ion-card-header>

    <ion-card-content>

      <ion-button expand="block" color="secondary"
                  (click)="scan()"
                  [disabled]="isScanning">
        <span *ngIf="!isScanning">Buscar</span>
        <ion-spinner *ngIf="isScanning"></ion-spinner>
      </ion-button>

      <ion-list *ngIf="(unpairedDevices$ | async)?.length! > 0">
        <ion-item *ngFor="let dev of unpairedDevices$ | async">
          <ion-label>
            <h2>{{ dev.name }}</h2>
            <p>{{ dev.address }}</p>
          </ion-label>

          <ion-button color="success"
                      (click)="tryConnect(dev)">
            Emparejar + Conectar
          </ion-button>
        </ion-item>
      </ion-list>

      <ion-item *ngIf="(unpairedDevices$ | async)?.length === 0 && !isScanning">
        <ion-label>No se encontraron dispositivos nuevos.</ion-label>
      </ion-item>

    </ion-card-content>
  </ion-card>


  <!-- INFO DE SENSORES -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Sensores</ion-card-title>
    </ion-card-header>

    <ion-card-content>

      <ion-item>
        <ion-label>Izquierda</ion-label>
        <ion-chip *ngIf="left$ | async as L" color="primary">{{ L }} cm</ion-chip>
        <ion-chip *ngIf="!(left$ | async)" color="medium">N/A</ion-chip>
      </ion-item>

      <ion-item>
        <ion-label>Derecha</ion-label>
        <ion-chip *ngIf="right$ | async as R" color="primary">{{ R }} cm</ion-chip>
        <ion-chip *ngIf="!(right$ | async)" color="medium">N/A</ion-chip>
      </ion-item>

      <ion-button expand="block" color="medium"
                  [disabled]="!(isConnected$ | async)"
                  (click)="requestStatus()">
        Solicitar STATUS
      </ion-button>

    </ion-card-content>
  </ion-card>


  <!-- RELÉS -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Relés</ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <ion-item>
        <ion-label>Izquierdo</ion-label>
        <ion-chip color="success" *ngIf="relayLeft$ | async">ON</ion-chip>
        <ion-chip color="danger" *ngIf="!(relayLeft$ | async)">OFF</ion-chip>
      </ion-item>

      <ion-item>
        <ion-label>Derecho</ion-label>
        <ion-chip color="success" *ngIf="relayRight$ | async">ON</ion-chip>
        <ion-chip color="danger" *ngIf="!(relayRight$ | async)">OFF</ion-chip>
      </ion-item>
    </ion-card-content>
  </ion-card>

</ion-content>


